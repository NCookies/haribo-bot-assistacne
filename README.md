# `노래하는하리보` 복구용 봇

디스코드에서 널리 사용되는 노래 봇 중 하나인 `노래하는하리보`는 점검이나 오류 등으로 오프라인이 되면 기존에 가지고 있던 노래 대기열이 초기화된다. 이 때 기존의 대기열을 일부라도 복구하기 위해 이 봇을 만들게 되었다.


## 사용방법

디스코드 앱 및 봇을 생성하여 토큰을 발급받는다. 이후 `BOT_TOKEN`에 직접 토큰 값을 넣어주거나, `bot_auth.py` 파일을 생성하여 토큰값을 별도로 관리해 줄 수 있다.

### 환경설정
```
python -m venv .venv
./venv/Scripts/activate
pip install discord.py
```

### bot_auth.py
```python
auth = {
    "token" : "DISCORD_BOT_TOKEN"
}
```

봇을 서버에 초대한 후 `!history` 명령어를 입력하면 프로젝트 폴더에 `music_list.txt`라는 파일을 생성한다. 만약 정상적으로 동작했다면 유튜브 링크들이 개행으로 분리되어 한 줄씩 있을텐데, 이들을 사용하여 유튜브 재생목록을 만들어준다.

> https://apps.dominiczelek.com/youtube-playlist-from-links/

위 링크에서 만들어진 링크들을 입력해주고 `Generate Playlist Link` 버튼을 클릭하면 `CLICK TO VIEW YOUR YOUTUBE PLAYLIST`라는 링크를 눌러준다. 그럼 생성된 유튜브 재생목록을 확인할 수 있다. 이 페이지의 URL을 복사하여 디스코드에서 `!!play <URL>`을 입력해주면 재생목록을 대기열에 추가할 수 있다.

참고로 이 사이트에서 재생목록은 최대 50개까지만 생성되니 주의하자.


## 임베디드 링크

명령어를 통해 노래가 정상적으로 추가되면 `노래하는하리보` 봇은 해당 메세지를 멘션하며 embed 데이터를 함께 첨부한다. 이 embed 데이터 안에 들어있는 노래의 링크를 파싱하여 유튜브 URL을 얻을 수 있다.

만약 재생목록 링크를 첨부하는 경우에는 답장 메세지에 첫 번째 곡만 표시되므로 별도의 처리가 필요하다.


## 노래하는하리보

개발 중 헷갈리는 부분이 있어서 정리했다. 이 봇에서 `재생목록`과 `대기열`은 별도로 존재한다.

### 재생목록 
- 영구
- 원하는 노래들을 직접 추가, 삭제할 수 있다.
- 대기열에 있는 노래들을 불러올 수 있다.
- 이들은 봇이 오프라인이 되어도 초기화되지 않는다.
- `!!play playlist <playlist_name>` 등으로 사용할 수 있다.

### 대기열
- 휘발성
- `!!play` 등의 명령어를 사용하면 추가되는 노래들이 저장되는 리스트이다.
- `!!stop` 등의 명령어를 사용하거나 점검, 오류 등으로 봇이 오프라인이 되면 초기화된다.

